<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>é—ªå…‰æ‘„å½±åŠ©æ‰‹</title>
    <style>
      :root {
        --primary: #007aff;
        --danger: #ff3b30;
        --warning: #ff9500;
        --success: #34c759;
        --night: #5856d6;
        --card-bg: #ffffff;
      }
      body {
        font-family: -apple-system, sans-serif;
        background: #f2f2f7;
        margin: 0;
        padding: 15px;
        color: #1c1c1e;
      }
      .app-container {
        max-width: 500px;
        margin: auto;
      }
      .card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        margin-bottom: 15px;
      }
      h1 {
        font-size: 20px;
        font-weight: 700;
        margin: 0 0 15px 0;
        text-align: center;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 15px;
      }
      label {
        font-size: 11px;
        font-weight: 600;
        color: #8e8e93;
        margin-bottom: 4px;
        text-transform: uppercase;
      }
      select,
      input {
        -webkit-appearance: none;
        background: #f2f2f7;
        border: none;
        border-radius: 10px;
        padding: 12px;
        font-size: 16px;
        color: #1c1c1e;
        width: 100%;
        box-sizing: border-box;
      }

      .result-panel {
        background: #1c1c1e;
        color: white;
        border-radius: 18px;
        padding: 25px;
        text-align: center;
        position: relative;
      }
      .power-label {
        font-size: 13px;
        color: #8e8e93;
        margin-bottom: 5px;
      }
      .power-value {
        font-size: 44px;
        font-weight: 800;
        color: var(--primary);
      }
      .badge-row {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 5px;
      }
      .badge {
        background: #3a3a3c;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 11px;
      }

      .status-light {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }

      .msg-card {
        padding: 15px;
        font-size: 13px;
        line-height: 1.5;
        border-radius: 12px;
        margin-top: 10px;
        border-left: 4px solid #ccc;
      }
      .msg-safe {
        background: #e8f5e9;
        border-left-color: var(--success);
      }
      .msg-warn {
        background: #fff3e0;
        border-left-color: var(--warning);
      }
      .msg-danger {
        background: #ffebee;
        border-left-color: var(--danger);
      }
      .msg-night {
        background: #f3f0ff;
        border-left-color: var(--night);
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <h1>é—ªå…‰æ‘„å½±åŠ©æ‰‹</h1>

      <div class="result-panel" id="resPanel">
        <div id="statusLight" class="status-light"></div>
        <div class="power-label">å»ºè®®é—ªå…‰è¾“å‡º (Mæ¡£)</div>
        <div id="powerVal" class="power-value">1/4</div>
        <div class="badge-row">
          <span id="compVal" class="badge">90mm | åŠèº«</span>
          <span id="evVal" class="badge">EV 5.0</span>
        </div>
      </div>

      <div class="card" style="margin-top: 15px">
        <label>GN</label>
            <input
              type="number"
              id="gn"
              value="20"
              step="1"
              oninput="calc()"
              style="margin-bottom: 15px;"
            />
        <div class="grid">
          <div class="input-group">
            <label>æ„Ÿå…‰åº¦</label>
            <select id="iso" onchange="calc()">
              <option value="50">50</option>
              <option value="80">80</option>
              <option value="100">100</option>
              <option value="200" selected>200</option>
              <option value="400">400</option>
              <option value="800">800</option>
              <option value="1600">1600</option>
            </select>
          </div>
          <div class="input-group">
            <label>é•œå¤´ç„¦è·</label>
            <select id="focal" onchange="calc()">
              <option value="28">28</option>
              <option value="35">35</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="55">55</option>
              <option value="70">70</option>
              <option value="90" selected>90</option>
              <option value="135">135</option>
              <option value="180">180</option>
              <option value="200">200</option>
            </select>
          </div>
        </div>

        <div class="grid">
          <div class="input-group">
            <label>å…‰åœˆ</label>
            <input
              type="number"
              id="apt"
              value="2.5"
              step="0.1"
              oninput="calc()"
            />
          </div>
          <div class="input-group">
            <label>å¿«é—¨é€Ÿåº¦</label>
            <select id="shutter" onchange="calc()">
              <option value="8000">1/8000</option>
              <option value="4000">1/4000</option>
              <option value="2000">1/2000</option>
              <option value="1000">1/1000</option>
              <option value="500">1/500</option>
              <option value="250">1/250</option>
              <option value="125" selected>1/125</option>
              <option value="60">1/60</option>
              <option value="30">1/30</option>
              <option value="15">1/15</option>
              <option value="8">1/8</option>
              <option value="4">1/4</option>
              <option value="2">1/2</option>
            </select>
          </div>
        </div>

        <label
          >æ‹æ‘„è·ç¦»:
          <span id="distNum" style="color: var(--primary)">3.0</span> ç±³</label
        >
        <input
          type="range"
          id="dist"
          min="0.8"
          max="12"
          step="0.1"
          value="3"
          oninput="calc()"
          style="width: 100%; margin-bottom: 15px"
        />

        <label>ç¯å¢ƒåœºæ™¯ (èƒŒæ™¯äº®åº¦)</label>
        <select id="weather" onchange="calc()">
          <option value="16">çƒˆæ—¥ (f/16)</option>
          <option value="11">æ™´å¤© (f/11)</option>
          <option value="8">å¤šäº‘ (f/8)</option>
          <option value="5.6">é˜´å¤©/å®¤å†…æ˜äº® (f/5.6)</option>
          <option value="2.8">é»„æ˜/å®¤å†…å¼±å…‰ (f/2.8)</option>
          <option value="1.0" selected>å¤œæ™¯/ææš—å®¤å†… (f/1.0)</option>
        </select>
      </div>

      <div id="msgBox" class="msg-card">æ­£åœ¨åˆå§‹åŒ–...</div>
    </div>

    <script>
      function calc() {
        const gn = parseInt(document.getElementById("gn").value);
        const iso = parseInt(document.getElementById("iso").value);
        const focal = parseInt(document.getElementById("focal").value);
        const apt = parseFloat(document.getElementById("apt").value);
        const dist = parseFloat(document.getElementById("dist").value);
        const shutter = parseInt(document.getElementById("shutter").value);
        const weatherRef = parseFloat(document.getElementById("weather").value);

        document.getElementById("distNum").innerText = dist.toFixed(1);

        // 1. é—ªå…‰è®¡ç®— (åŸºå‡†GN20@ISO100)
        const currentGN = gn * Math.sqrt(iso / 100);
        const ratio = Math.pow((apt * dist) / currentGN, 2);
        const levels = [
          { v: 0.7, t: "1/1" },
          { v: 0.35, t: "1/2" },
          { v: 0.18, t: "1/4" },
          { v: 0.09, t: "1/8" },
          { v: 0.045, t: "1/16" },
          { v: 0.02, t: "1/32" },
        ];
        let power = ratio > 1.1 ? "åŠŸç‡ä¸è¶³" : "1/64";
        for (let l of levels) {
          if (ratio > l.v) {
            power = l.t;
            break;
          }
        }
        document.getElementById("powerVal").innerText = power;

        // 2. æ„å›¾åˆ¤æ–­
        const viewW = (36 * dist) / focal;
        const comp = viewW > 2 ? "å…¨èº«" : viewW > 0.8 ? "åŠèº«" : "ç‰¹å†™";
        document.getElementById("compVal").innerText = `${focal}mm | ${comp}`;

        // 3. èƒŒæ™¯æ›å…‰é€»è¾‘
        const msgBox = document.getElementById("msgBox");
        const light = document.getElementById("statusLight");
        const evDiff =
          Math.log2(shutter / iso) + Math.log2(apt / weatherRef) * 2;
        document.getElementById("evVal").innerText =
          `åå·®: ${evDiff > 0 ? "+" : ""}${evDiff.toFixed(1)} EV`;

        if (weatherRef <= 1.4) {
          // å¤œæ™¯æ¨¡å¼
          light.style.background = "var(--night)";
          if (shutter > 60) {
            msgBox.className = "msg-card msg-night";
            msgBox.innerHTML =
              "ğŸŒ™ <b>å¤œæ™¯æ¨¡å¼</b><br>å¿«é—¨è¾ƒå¿«ï¼ŒèƒŒæ™¯å¯èƒ½å…¨é»‘ã€‚å»ºè®®è°ƒæ…¢å¿«é—¨ï¼ˆå¦‚1/30sï¼‰ä»¥æ•æ‰ç¯å¢ƒç¯å…‰ã€‚";
          } else if (shutter < focal / 1.5) {
            msgBox.className = "msg-card msg-warn";
            msgBox.innerHTML = `âš ï¸ <b>é•¿æ›å…‰è­¦å‘Š</b><br>å¿«é—¨æ…¢äºå®‰å…¨å€¼(1/${focal}s)ã€‚é—ªå…‰ä¼šå‡å›ºäººåƒï¼Œä½†èƒŒæ™¯ç¯å…‰å¯èƒ½å› æ‰‹æŠ–äº§ç”Ÿé‡å½±ã€‚`;
          } else {
            msgBox.className = "msg-card msg-safe";
            msgBox.innerHTML =
              "âœ… <b>å¤œæ™¯å¹³è¡¡</b><br>ç¯å¢ƒç¯å…‰å°†å¾—åˆ°ä¿ç•™ï¼Œé—ªå…‰ç¯è´Ÿè´£å‡å›ºä¸»ä½“ã€‚";
          }
        } else if (evDiff < -1.5) {
          // è¿‡æ›è­¦å‘Š
          light.style.background = "var(--danger)";
          msgBox.className = "msg-card msg-danger";
          msgBox.innerHTML = `âŒ <b>èƒŒæ™¯å°†ä¸¥é‡è¿‡æ›ï¼</b><br>å½“å‰ç¯å¢ƒå¤ªäº®ã€‚å»ºè®®ç¼©å¿«é—¨è‡³ 1/${Math.round(iso * Math.pow(weatherRef / apt, 2))}s æˆ–ç¼©å°å…‰åœˆã€‚`;
        } else {
          light.style.background = "var(--success)";
          msgBox.className = "msg-card msg-safe";
          msgBox.innerHTML =
            "âœ… <b>æ›å…‰å¹³è¡¡</b><br>ä¸»ä½“ä¸èƒŒæ™¯æ¯”ä¾‹åè°ƒï¼Œèƒ¶ç‰‡å®½å®¹åº¦å¯è¦†ç›–ã€‚";
        }
      }
      calc();
    </script>
  </body>
</html>
